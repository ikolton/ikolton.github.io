---
import Layout from "@/layouts/Layout.astro";
import { experiences, education, skills, publications } from "../data/cv";
import CvTimeline from "@/components/ui/CvTimeline.astro";

import type { Experience, Education, Publication } from "../types/cv";
import List from "@/components/ui/List.astro";
import PublicationsList from "@/components/ui/PublicationsList.astro";
import { template } from "@/settings";

let orderedExperiences: Experience[] = [];
let orderedEducations: Education[] = [];
let orderedPublications: Publication[] = [];

const orderElement = <T extends { time: string }>(a: T, b: T) => {
	const presentValues = ["present", "now", "current", "today"];
	if (
		presentValues.includes(
			(a["time"] as string)?.split(" - ")[1]?.toLowerCase(),
		)
	) {
		// If the date is 'present', it should be the first element
		return -1;
	}
	const dateA = new Date((a["time"] as string)?.split(" - ")[1]);
	const dateB = new Date((b["time"] as string)?.split(" - ")[1]);
	return dateB.getTime() - dateA.getTime();
};

if (experiences.length > 0) {
	orderedExperiences = experiences.sort((a, b) => {
		return orderElement(a, b);
	});
}

if (education.length > 0) {
	orderedEducations = education.sort((a, b) => {
		return orderElement(a, b);
	});
}

if (publications.length > 0) {
	orderedPublications = publications.sort((a, b) => {
		return orderElement(a, b);
	});
}
---

<Layout>
	<!-- about me  -->
	<section class="mb-12">
		<h2 class="text-2xl font-bold mb-6 border-b pb-2">About Me</h2>
		<p class="text-lg text-base-content/80 leading-relaxed">
			I’m a Computer Science student at the Jagiellonian University,
			currently pursuing my master’s degree. My main interests focus on
			machine learning and computer vision, especially their applications
			in medical imaging and data analysis. At the same time, I’m
			passionate about software engineering — I enjoy low-level
			programming in C++, designing systems and architectures, and
			creating practical tools that actually solve problems. I like
			understanding how things work and turning ideas into something real
			and useful.
		</p>
	</section>

	{
		orderedEducations.length > 0 && (
			<section class="mb-12">
				<h2 class="text-2xl font-bold mb-6 border-b pb-2">Education</h2>
				<CvTimeline elements={orderedEducations} colored={true} />
			</section>
		)
	}

	{
		orderedExperiences.length > 0 && (
			<section class="mb-12">
				<h2 class="text-2xl font-bold mb-6 border-b pb-2">
					Experiences
				</h2>
				<CvTimeline elements={orderedExperiences} colored={true} />
			</section>
		)
	}

	{
		skills.length > 0 && (
			<section class="mb-12">
				<List listTitle="Skills" listItems={skills} />
			</section>
		)
	}

	{
		// orderedPublications.length > 0 && (
		// 	<section class='mb-12'>
		// 		<h2 class='text-2xl font-bold mb-6 border-b pb-2'>
		// 			Last publications
		// 		</h2>
		// 		<PublicationsList elements={orderedPublications}/>
		// 	</section>
		// )
		orderedPublications.length > 0 && (
			<section class="mb-12">
				<h2 class="text-2xl font-bold mb-6 border-b pb-2">
					<a
						href={`${template.base}/papers`}
						class="hover:text-accent transition-colors"
					>
						Last publications
					</a>
				</h2>
				<PublicationsList elements={orderedPublications} />
			</section>
		)
	}
</Layout>
